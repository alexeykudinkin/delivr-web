<!DOCTYPE html>
<html>
<head>

  <title>Shipper</title>

  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <style type="text/css">

    html {
      height: 100%
    }

    body {
      height: 100%;
      margin: 0;
      padding: 0
    }

    #map-canvas {
      width: 100%;
      height: 100%
    }

  </style>
  <script type="text/javascript"
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCH-W-G8oHPVT647mSRseuSvRhLUWMQPps&sensor=true">
  </script>
  <script type="text/javascript">

    var travel =
      {
        origin:       { tracking: false },
        destination:  { tracking: false }
      };

    var map, gc;

    function initialize() {
      var mapOptions = {
          center: new google.maps.LatLng(59.96512, 30.15732),
          zoom: 10
        };

      gc  = new google.maps.Geocoder();
      map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

      var tracker =
          google.maps.event.addListener(map, 'click', function (click) {
            var location = click.latLng;
            var markerOptions = {
              position: location,
              map: map,
              draggable: true
            };

            if (travel.origin.tracking)
            {
              var originMarker = new google.maps.Marker(markerOptions);

              travel.origin = {
                location: location,
                marker:   originMarker,
                form:     document.getElementById('travel-origin'),
                tracking: false
              };

              google.maps.event.addListener(originMarker, 'dragend', function (_) {
                  reverseGeocode(originMarker.getPosition(), function (reversed) {
                    travel.origin.form.placeholder = reversed;
                  });
                });

              reverseGeocode(location, function (reversed) {
                travel.origin.form.placeholder = reversed;
              })
            }
            else if (travel.destination.tracking)
            {
              var destinationMarker = new google.maps.Marker(markerOptions);

              travel.destination = {
                location: location,
                marker:   destinationMarker,
                form:     document.getElementById('travel-destination'),
                tracking: false
              };

              google.maps.event.addListener(destinationMarker, 'dragend', function (_) {
                  reverseGeocode(destinationMarker.getPosition(), function (reversed) {
                    travel.destination.form.placeholder = reversed;
                  });
                });

              reverseGeocode(location, function (reversed) {
                  travel.destination.form.placeholder = reversed;
                });
            }
          });
    }

    function reverseGeocode(loc, callback) {
      gc.geocode({ latLng: loc }, function (results, status) {
        if (status == google.maps.GeocoderStatus.OK)
          callback(results[0].formatted_address);
        else
          callback(location);
      });
    }

    function trackOrigin() {
      travel.origin.tracking = true;
    }

    function trackDestination() {
      travel.destination.tracking = true;
    }

    google.maps.event.addDomListener(window, 'load', initialize);
  </script>

</head>
<body>
  <div id="map-canvas" style="top: 0; left: 0; position: absolute;"></div>

  <div style="position: absolute; top: 50pt; left: 50pt; height: 150pt; width: 150pt; background: #ffffff; z-index: 10000">
    <input id="travel-origin" placeholder="A" onclick="trackOrigin()"/>
    <input id="travel-destination" placeholder="B" onclick="trackDestination()"/>
  </div>
</body>
</html>